# 並行処理における重要概念まとめ

この文書では、並行処理・並列処理に関する主要な概念について、「意味」「問題点」「利点」の観点から解説します。DSL設計や並行プログラムの設計思想の理解に役立ちます。

---

## 🧵 Data Race（データ競合）

- **意味**: 複数のスレッドや処理が同じ変数に対し、同時に読み書きを行うことで未定義な動作を引き起こす。
- **問題**: 値の破損、予測不能な挙動、深刻なバグの原因になる。
- **利点（対処法）**: actorモデルやatomic操作で回避できれば、安全でスケーラブルな実装が可能。

---

## ⚠️ Race Condition（競合状態）

- **意味**: 実行順序に依存する処理で、タイミングによって結果が変わる状態。
- **問題**: 同じコードでもタイミング次第で不具合が発生。再現困難。
- **利点（対処法）**: atomicブロックやトランザクションで順序を保証すれば、意図通りの動作を担保できる。

---

## 🔐 Atomicity（原子性）

- **意味**: 一連の操作を「分割不可能な1つの単位」として扱うこと。
- **問題**: 原子性がないと中間状態が他に見えてしまい、競合や不整合が起こる。
- **利点**: 原子的処理により状態の一貫性を保ち、データの信頼性が向上する。

---

## 🔀 Interleaving（命令の交錯）

- **意味**: 並行実行により、複数の処理の命令が交互に実行されること。
- **問題**: 意図しない順序で副作用が発生する可能性。
- **利点（対処法）**: actorや状態の分離により、処理の衝突を防げる。

---

## 📊 Consistency（整合性）

- **意味**: システム全体の状態が常に論理的に正しいこと。
- **問題**: 並行操作によりデータの不一致や破損が発生。
- **利点**: トランザクションや不変データの導入で高い一貫性を保てる。

---

## 🔒 Deadlock / 🔄 Livelock / 🕳 Starvation（停止系問題）

### Deadlock（デッドロック）
- **意味**: 複数の処理が相互にリソースを待ち続けて停止する。
- **問題**: プログラムが進行不能に。
- **利点（対処法）**: ロック順の統一、タイムアウト、メッセージ通信で予防。

### Livelock（ライブロック）
- **意味**: 処理が譲り合いすぎて一切進まなくなる。
- **問題**: 状態が変わっても処理が前進しない。
- **利点（対処法）**: バックオフ戦略や状態制御で解決可能。

### Starvation（飢餓）
- **意味**: 優先度などの制約で一部の処理が実行されないままになる。
- **問題**: 処理の公平性が失われる。
- **利点（対処法）**: 優先度の調整やスケジューリングの工夫で対処。

---

## 🧱 Fault Tolerance（障害耐性）

- **意味**: 部分的な障害が発生しても、システム全体として機能し続ける能力。
- **問題**: エラーが未処理の場合、全体がクラッシュ。
- **利点**: 再試行、監視、フェイルオーバーにより高可用性を実現。

---

## 🎲 Determinism / Non-determinism（決定性）

- **意味**:
  - **決定性**: 同じ入力で常に同じ出力になる。
  - **非決定性**: 並行実行により出力が変化する可能性がある。
- **問題**: 非決定性が高いとバグの再現性・検証が困難。
- **利点**: イベント順序の制御や状態記録で決定性を高められる。

---

## 📬 Actor Model / Message Passing

- **意味**: 各処理単位（アクター）が独立した状態を持ち、メッセージを使って通信。
- **問題**: 明示的な共有がないため設計が必要。
- **利点**: データ競合なし。分散・スケーラブル・直感的な並行処理が可能。

---

## 🔐 Lock / Mutex / Semaphore / Monitor

- **意味**: 複数処理間で共有リソースを排他制御する手段。
- **問題**: 誤用するとデッドロック、性能低下。
- **利点**: 適切に使えばデータの整合性を安全に維持できる。

---

## 💳 Transactional Memory / Snapshot Isolation

### Transactional Memory
- **意味**: 複数の変数を一括で更新し、競合時にはロールバックする。
- **問題**: 実装が重い。全ての操作に適さない。
- **利点**: ロックレスで安全な並行データ更新が可能。

### Snapshot Isolation
- **意味**: 読み取りは過去の一貫性あるスナップショットから行う。
- **問題**: 最新ではない可能性がある。
- **利点**: 読み取りと書き込みの干渉を回避できる。

---

## 🧊 Immutable Data（不変性）

- **意味**: 一度作成したデータは変更不可。変更は新しいコピーを生成。
- **問題**: パフォーマンスに注意が必要（コピーコスト）。
- **利点**: 共有・並行アクセスで安全。副作用がなくデバッグが容易。

---

## ✍️ Copy-on-Write（書き込み時複製）

- **意味**: 書き込み時のみデータを複製して変更する手法。
- **問題**: 大きなデータ構造ではメモリコストに注意。
- **利点**: 読み取り性能を維持しつつ、不変性と効率性を両立できる。

---

> 📌 これらの概念を理解し、うまく設計に取り込むことで、安全でスケーラブルな並行処理システムの実装が可能になります。