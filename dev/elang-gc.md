# Erlang separate GC

## Copy GC　(コピー方式GC)

下記のようなルートがあったとする。
```
Root1 (stack) := A ──▶ A.e ──▶ B ──▶ B.e
Root2 (stack) := C ──▶ C.e ──▶ B ──▶ B.e
```
この時、Rootの上から順に、メモリーを新たなヒープメモリにコピーを行う。
メモリのコピーは、コピーし、元のメモリには、次のポインタのアドレスを記載する。(フォワーディングポインタ)
そのため、Root1のコピー後、ヒープメモリは下記のようになる。

| addr | from heap | addr | to heap |
| ---- | ---- | ---- | ---- |
| 0x00 | 0x10 | 0x10 |  A   |
| 0x01 | 0x11 | 0x11 |  A.e |
| 0x02 | 0x12 | 0x12 |  B   |
| 0x03 | 0x13 | 0x13 |  B.e |
| 0x04 | C    | 0x14 |  C   |
| 0x05 | C.e  | 0x15 |  C.e |

元の***A***は、`0x00`にデータが入っていたが、それを`0x10`に写し、`0x00`のメモリには`0x10`を移すようにする。
こうすることで、***C.e***が***B***にアクセスした時、そこに保存されているフォワードポインタである`0x12`を取得することで、
正常に動作するようにしている。

## XX GC (世代別GC)

Copyの頻度や回数を記録し、一定の回数を超えると`Young heap`から`Old heap`に移すことで、可能とする。

## reference
[Erlang GC](https://www.erlang.org/doc/apps/erts/garbagecollection.html)