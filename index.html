<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>Shica + Ghost Click Color</title>

  <!-- ACE Editor CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.0/ace.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.0/mode-javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.0/theme-textmate.min.js"></script>

  <style>
    body {
      background-color: #f5f7fa;
      font-family: "Segoe UI", sans-serif;
      margin: 0;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    #left, #right {
      overflow: auto;
      height: 100vh;
    }
    #left {
      flex: 1;
      background-color: white;
      color: black;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }
    #right {
      flex: 1;
      background-color: white;
      padding: 24px;
    }
    #map {
      position: relative;
      width: 1000px;  /* Ê®™ÂπÖ 1000px */
      height: 600px;  /* È´ò„Åï 600px */
      border: 5px solid #4a90e2;
      box-sizing: border-box;
      background-color: #222;
      background-image:
        linear-gradient(#555 1px, transparent 1px),
        linear-gradient(90deg, #555 1px, transparent 1px);
      background-size: 30px 30px;
    }
    .ghost {
      position: absolute;
      width: 50px;
      height: 50px;
      font-size: 50px;
      line-height: 50px;
      text-align: center;
      cursor: pointer;
      filter: drop-shadow(0 0 5px white);
      transition: filter 0.2s ease;
    }
    .ghost.clicked {
      filter: drop-shadow(0 0 5px lime);
    }
    #info {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background-color: rgba(255,255,255,0.9);
      color: black;
      font-size: 14px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      white-space: pre-line;
    }
    .editor-box {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 0;
      margin-bottom: 16px;
      height: 300px;
    }
    #editor {
      width: 100%;
      height: 100%;
      font-size: 14px;
    }
    .buttons {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 16px;
    }
    button {
      background-color: #4a90e2;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s ease, transform 0.1s ease;
    }
    button:hover {
      background-color: #357abd;
      transform: translateY(-2px);
    }
    pre {
      background: #eee;
      padding: 10px;
      border-radius: 8px;
      white-space: pre-wrap;
      min-height: 40px;
    }
  </style>
</head>

<body>

  <!-- Â∑¶ÂÅ¥ÔºöÂ§ß„Åç„ÇÅ„ÅÆ„Éû„ÉÉ„Éó„Å®„Ç¥„Éº„Çπ„Éà -->
  <div id="left">
    <div id="map">
      <div class="ghost" id="ghost1" style="left:100px; top:100px;">üëª</div>
    </div>
    <div id="info"></div>
  </div>

  <!-- Âè≥ÂÅ¥ÔºöShica„Ç®„Éá„Ç£„Çø -->
  <div id="right">
    <h1>Shica: Demonstration of a Compiler and VM <br />Implemented in C and Leg</h1>
    <div class="editor-box">
      <div id="editor"></div>
    </div>
    <pre id="output">The output will be displayed here</pre>
    <div class="buttons">
      <button id="storeBtn">Load</button>
      <button id="compileBtn">Compile</button>
      <button id="runBtn">‚ñ∂ Run</button>
    </div>
    <pre id="outputIR">Compiled code will be displayed here</pre>
    <pre id="outputResult">Executed result will be displayed here</pre>
  </div>

  <!-- Script -->
  <script>
    // ACE Editor ÂàùÊúüÂåñ
    const editor = ace.edit("editor");
    editor.setTheme("ace/theme/textmate");
    editor.setOptions({
      fontSize: "14px",
      showLineNumbers: true,
      showGutter: true,
      wrap: false,
      tabSize: 2,
    });
    
    // Ë°åÈñì„ÇíÊúÄÂ∞è„Å´Ë®≠ÂÆö
    editor.container.style.lineHeight = "1.0";
    editor.renderer.setOption('scrollPastEnd', false);
    editor.renderer.updateFull();

    // „Ç¥„Éº„Çπ„ÉàÁßªÂãï„É≠„Ç∏„ÉÉ„ÇØ
    const ghost = document.getElementById("ghost1");
    const info = document.getElementById("info");
    const mapWidth = 900;
    const mapHeight = 600;
    const ghostSize = 50;

    let posX = 100, posY = 100;
    let vx = 2, vy = 2;
    let isClicked = false;

    // „Ç¥„Éº„Çπ„Éà„ÇØ„É™„ÉÉ„ÇØ„ÅßËâ≤„Å®Áä∂ÊÖãÂàá„ÇäÊõø„Åà
    ghost.addEventListener("click", () => {
      isClicked = !isClicked;
      ghost.classList.toggle("clicked", isClicked);
    });

    function moveGhost() {
      posX += vx;
      posY += vy;

      if (posX <= 0 || posX >= mapWidth - ghostSize) vx *= -1;
      if (posY <= 0 || posY >= mapHeight - ghostSize) vy *= -1;

      ghost.style.left = posX + "px";
      ghost.style.top = posY + "px";

      // ÈÄ≤Ë°åÊñπÂêë„ÅÆÂ£Å„Åæ„Åß„ÅÆË∑ùÈõ¢
      let distX = vx > 0 ? (mapWidth - ghostSize - posX) : posX;
      let distY = vy > 0 ? (mapHeight - ghostSize - posY) : posY;

      info.textContent =
        `x: ${Math.round(posX)}\n` +
        `y: ${Math.round(posY)}\n` +
        `vx: ${vx}\n` +
        `vy: ${vy}\n` +
        `clicked: ${isClicked}\n` +
        `dist to wall x: ${Math.round(distX)}\n` +
        `dist to wall y: ${Math.round(distY)}`;

      requestAnimationFrame(moveGhost);
    }
    moveGhost();

    // „Éú„Çø„É≥„ÅÆÂãï‰Ωú
    document.getElementById("storeBtn").addEventListener("click", () => {
      document.getElementById("output").textContent = "Load clicked";
    });

    document.getElementById("compileBtn").addEventListener("click", () => {
      const code = editor.getValue();
      document.getElementById("outputIR").textContent = `Compiling:\n${code}`;
    });

    document.getElementById("runBtn").addEventListener("click", () => {
      const code = editor.getValue();
      document.getElementById("outputResult").textContent = `Running:\n${code}`;
    });
  </script>

</body>
</html>